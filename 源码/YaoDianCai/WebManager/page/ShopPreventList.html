<!DOCTYPE html>
<html>
<head>
    <title>商家认证列表界面</title>
    <meta http-equiv="pragma" content="no-cache" />
    <meta http-equiv="cache-control" content="no-cache" />
    <meta http-equiv="expires" content="0" />
    <link type="text/css" href="/res/css/shopslist.css" rel="stylesheet" />
    <link type="text/css" href="/res/css/datepicker.css" rel="stylesheet" />
    <script type="text/javascript" src="/res/js/jquery.min.js"></script>
    <script type="text/javascript" src="/res/js/jquery-1.2.6.pack.js"></script>
    <script type="text/javascript" src="/res/js/jquery.cookie.js"></script>
    <script type="text/javascript" src="/res/js/backpage-top.js"></script>
    <script type="text/javascript" src="/res/js/jquery.pagination.js"></script>
    <script type="text/javascript" src="/res/js/datepicker.js"></script>
    <script type="text/javascript">
        var SID = request.QueryString("SID");
        var name = request.QueryString("name");
        var maxResult = 20;
        function appendAuthList(data) {
            var html = "";
            for (var i = 0; i < data.length; i++) {
                html += '<div class="prevent_auth_list_td">' +
                            '<div class="prevent_auth_list_td_1">' + data[i].MAC + '</div>' +
                            '<div class="prevent_auth_list_td_2">' + data[i].MACCount + '</div>' +
                            '<div class="prevent_auth_list_td_3"></div>' +
                            '<div class="prevent_auth_list_td_4" onclick="preventState(\'' + SID + '\',\'' + data[i].MAC + '\');"></div>' +
                        '</div>';
            }
            $(".shop_prevent_auth_list").append(html);
        }
        function appendPreventList(data) {
            var html = "";
            for (var i = 0; i < data.length; i++) {
                html += '<div class="prevent_prevent_list_td">' +
                            '<div class="prevent_prevent_list_td_1">' + data[i].MAC + '</div>' +
                            '<div class="prevent_prevent_list_td_2" onclick="preventCancle(\'' + data[i].SID + '\',\'' + data[i].MAC + '\');"></div>' +
                        '</div>';
            }
            $(".shop_prevent_prevent_list").append(html);
        }
        function preventPrevent() {
            $(".shop_prevent_tab_auth").css("border-left", "0px solid #D5D5D5");
            $(".shop_prevent_tab_auth").css("border-right", "0px solid #D5D5D5");
            $(".shop_prevent_tab_auth").css("background-color", "transparent");
            $(".shop_prevent_auth_list").css("display", "none");
            $(".pagination").css("display", "none");

            $(".shop_prevent_tab_prevent").css("border-left", "1px solid #D5D5D5");
            $(".shop_prevent_tab_prevent").css("border-right", "1px solid #D5D5D5");
            $(".shop_prevent_tab_prevent").css("background-color", "#FFFFFF");
            $(".shop_prevent_prevent_list").css("display", "block");
            $.ajax({
                type: 'post',
                url: '/action/NetPreventAction.ashx',
                data: { option: 'OP_GetNetPreventList', SID: SID },
                dataType: 'json',
                success: function (msg) {
                    $(".prevent_prevent_list_td").remove();
                    if (msg.ok) {
                        appendPreventList(msg.lists);
                    } else {
                        $(".prevent_prevent_list_td").remove();
                    }
                }
            });
        }
        function preventAuth() {
            var pageselectCallback = function (page_index) {
                $(".prevent_auth_list_td").remove();
                $.ajax({
                    type: 'post',
                    url: '/action/WifiAuthAction.ashx',
                    data: { option: 'OP_WifiAuthDistinction_List', SID: SID, firstResult: page_index * maxResult, maxResult: maxResult },
                    dataType: 'json',
                    success: function (msg) {
                        if (msg.ok) {
                            appendAuthList(msg.lists);
                        } else {
                            $(".prevent_auth_list_td").remove();
                        }
                    }
                });
                return true;
            }
            $(".shop_prevent_tab_auth").css("border-left", "1px solid #D5D5D5");
            $(".shop_prevent_tab_auth").css("border-right", "1px solid #D5D5D5");
            $(".shop_prevent_tab_auth").css("background-color", "#FFFFFF");
            $(".shop_prevent_auth_list").css("display", "block");
            $(".pagination").css("display", "block");

            $(".shop_prevent_tab_prevent").css("border-left", "0px solid #D5D5D5");
            $(".shop_prevent_tab_prevent").css("border-right", "0px solid #D5D5D5");
            $(".shop_prevent_tab_prevent").css("background-color", "transparent");
            $(".shop_prevent_prevent_list").css("display", "none");

            $.ajax({
                type: 'post',
                url: '/action/WifiAuthAction.ashx',
                data: { option: 'OP_WifiAuthDistinction_Count', SID: SID },
                dataType: 'json',
                success: function (msg) {
                    if (msg.ok) {
                        $("#Pagination").pagination(msg.count, {
                            num_edge_entries: 1,
                            items_per_page: maxResult,
                            prev_text: "&nbsp;",
                            next_text: "&nbsp;",
                            ellipse_text: "&nbsp;",
                            callback: pageselectCallback
                        });
                    }
                }
            });
        }

        function preventAuthSearch(search) {
            var pageselectCallback = function (page_index) {
                $(".prevent_auth_list_td").remove();
                $.ajax({
                    type: 'post',
                    url: '/action/WifiAuthAction.ashx',
                    data: { option: 'OP_WifiAuthDistinctionSearch_List', searchKey: search, SID: SID, firstResult: page_index * maxResult, maxResult: maxResult },
                    dataType: 'json',
                    success: function (msg) {
                        if (msg.ok) {
                            appendAuthList(msg.lists);
                        } else {
                            $(".prevent_auth_list_td").remove();
                        }
                    }
                });
                return true;
            }
            $(".shop_prevent_tab_auth").css("border-left", "1px solid #D5D5D5");
            $(".shop_prevent_tab_auth").css("border-right", "1px solid #D5D5D5");
            $(".shop_prevent_tab_auth").css("background-color", "#FFFFFF");
            $(".shop_prevent_auth_list").css("display", "block");
            $(".pagination").css("display", "block");

            $(".shop_prevent_tab_prevent").css("border-left", "0px solid #D5D5D5");
            $(".shop_prevent_tab_prevent").css("border-right", "0px solid #D5D5D5");
            $(".shop_prevent_tab_prevent").css("background-color", "transparent");
            $(".shop_prevent_prevent_list").css("display", "none");

            $.ajax({
                type: 'post',
                url: '/action/WifiAuthAction.ashx',
                data: { option: 'OP_WifiAuthDistinctionSearch_Count', SID: SID, searchKey: search },
                dataType: 'json',
                success: function (msg) {
                    if (msg.ok) {
                        $("#Pagination").pagination(msg.count, {
                            num_edge_entries: 1,
                            items_per_page: maxResult,
                            prev_text: "&nbsp;",
                            next_text: "&nbsp;",
                            ellipse_text: "&nbsp;",
                            callback: pageselectCallback
                        });
                    }
                }
            });

        }

        function preventSubmit() {
            var MAC = $.trim($(".shop_prevent_top_input input[name='preventMac']").val());
            if(MAC==""){
                alert("请输入要限制用户的MAC地址。");
                return;
            }
            var reg_name = /[A-F\d]{2}:[A-F\d]{2}:[A-F\d]{2}:[A-F\d]{2}:[A-F\d]{2}:[A-F\d]{2}/;

            if (!reg_name.test(MAC)) {
                alert("mac地址格式不正确！mac地址格式为00:24:21:19:BD:E4");
                return;
            }

            $.ajax({
                type: 'post',
                url: '/action/NetPreventAction.ashx',
                data: { option: 'OP_NetPreventAdd', SID: SID, MAC: MAC },
                dataType: 'json',
                success: function (msg) {
                    if (msg.ok) {
                        alert("添加成功。");
                        $(".shop_prevent_top_input input[name='preventMac']").val("");
                    } else {
                        alert("添加失败。");
                    }
                }
            });

        }
        function preventState(SID, MAC) {
            $.ajax({
                type: 'post',
                url: '/action/NetPreventAction.ashx',
                data: { option: 'OP_NetPreventAdd', SID: SID, MAC: MAC },
                dataType: 'json',
                success: function (msg) {
                    if (msg.ok) {
                        preventAuth();
                    } else {
                        alert("限制用户MAC失败。");
                    }
                }
            });
        }
        function preventCancle(SID,MAC) {
            $.ajax({
                type: 'post',
                url: '/action/NetPreventAction.ashx',
                data: { option: 'OP_NetPreventDelete', SID: SID, MAC: MAC },
                dataType: 'json',
                success: function (msg) {
                    if (msg.ok) {
                        alert("解除限制成功。");
                        preventPrevent();
                    } else {
                        alert("解除限制失败。");
                    }
                }
            });
        }

        function search() {
            var search = $.trim($("input[name='search']").val());
            if (search == "") {
                preventAuth();
            } else {
                preventAuthSearch(search);
            }
        }
        $('document').ready(function () {
            $(".logo_top_right span").text(userInfo.account);
            $(".navigation_left_name").text(decodeURI(name));

            preventAuth();
        });
    </script>
</head>
<body>
    <div class="body_panel">
        <div class="logo_top">
            <div class="logo_top_left"><img src="/res/images/shops/top-logo.png" width="100%" height="100%" alt="" /></div>
            <div class="logo_top_right">
                <div><span>用户名</span></div>
                <div onclick="user_exit();" style="cursor:pointer"><img src="/res/images/quit.png" width="100%" height="100%" alt="" /></div>
            </div>
        </div>
        <div class="right_tab">
            <div class="right_tab_shop" onclick="right_tab_shop();"><div class="right_tab_font tab_font_shop">0</div></div>
            <div class="right_tab_menu" onclick="right_tab_menu();"><div class="right_tab_font tab_font_menu">0</div></div>
            <div class="right_tab_tuan" onclick="right_tab_tuan();"><div class="right_tab_font tab_font_tuan">0</div></div>
            <div class="right_tab_auth" onclick="right_tab_auth();"><div class="right_tab_font tab_font_auth">0</div></div>
            <div class="right_tab_tab"  onclick="right_tab_tab();" ><div class="right_tab_font tab_font_tab" >0</div></div>
            <div class="right_tab_chat" onclick="right_tab_chat();"><div class="right_tab_font tab_font_chat">0</div></div>
        </div>
        <div class="navigation">
            <div class="navigation_left">
                <div class="navigation_left_head"></div>
                <div class="navigation_left_middle" onclick="right_tab_shop();" style="cursor:pointer;font:14px/18px '宋体',arial,sans-serif;"><span>商家列表</span></div>
                <div class="navigation_left_center"></div>
            </div>
            <div class="navigation_left">
                <div class="navigation_left_middle"  style="font:14px/18px '宋体',arial,sans-serif;"><div class='logo_shop'></div><span class="navigation_left_name"></span></div>
                <div class="navigation_left_center"></div>
            </div>
            <div class="navigation_left">
                <div class="navigation_left_middle"  style="font:14px/18px '宋体',arial,sans-serif;"><span>流量控制</span></div>
                <div class="navigation_left_end"></div>
            </div>

        </div>

        <div class="shop_prevent_top">
            <div class="shop_prevent_top_font">请输入限制用户的MAC地址：</div>
            <div class="shop_prevent_top_input"><input name="preventMac"/></div>
            <div class="shop_prevent_top_button" onclick="preventSubmit();"></div>
            
            <div class="navigation_center">
                <input name="search" />
                <div class="navigation_center_search" onclick="search();"></div>
            </div>
        </div>

        <div class="shop_prevent_tab">
            <div class="shop_prevent_tab_auth" onclick="preventAuth();">允许MAC</div>
            <div class="shop_prevent_tab_prevent" onclick="preventPrevent();">限制MAC</div>
        </div>

        <div class="shop_prevent_auth_list">
            <div class="prevent_auth_list_th">
                <div class="prevent_auth_list_th_1">允许MAC</div>
                <div class="prevent_auth_list_th_2">认证次数</div>
                <div class="prevent_auth_list_th_3">认证时间</div>
                <div class="prevent_auth_list_th_4">状态</div>
            </div>
        </div>
        <div class="pagination">
            <div id="Pagination">
            </div>
        </div>
        <div class="shop_prevent_prevent_list">
            <div class="prevent_prevent_list_th">
                <div class="prevent_prevent_list_th_1">限制MAC</div>
                <div class="prevent_prevent_list_th_2">开通</div>
            </div>
        </div>
    </div>
</body>
</html>
